#											#
# CDO-based routine for the preparation of OpenIFS nudging files			#
#											#
# 2011: 	Implementation of the interpolation routines (nudging_cdo.sh and	#
#		create_template_OIFS.sh) for ECHAM.					#
#		S. Rast, A. Voigt, U. Schulzweida					#
#											#
# 2021: 	Adaptation of the interpolation routines (nudging_cdo.sh and		#
#                create_template_OIFS.sh) for OpenIFS.					#
#		Implementation of the preprocessing routine preprocess_inputdata.sh.	#
#		M. Athanase, H. Goessling						#
#											#
#########################################################################################
Routines must be preferably called in the following order:

create_template_OIFS.sh

                - Description:
                Generate a template file needed for interpolation (FROM OIFS FILES).
                Must be called before nudging_cdo.sh if no template file exists
                for the requested resolution!

                - Called as:
                ./create_template.sh <resolution> <exp_ID>

                - Example:
                ./create_template.sh TCO159L91 h9wu

                - Comments: 
		The input files will be taken from INIT files for the requested grid.
                The files are GRIB format.
                The exp_ID is different for each grid! Check in the folder:
                /work/ab0246/a270092/input/oifs-43r3/<resolution>/ first.


preprocess_inputdata.sh

		- Description:
		Main script for the preparation of reanalysis data into readable 
		monthly files for the preparation of nudging files.
		Must be called before nudging_cdo.sh if the requested period has 
		not been pre-processed before!

		- Called as:
		./preprocess_inputdata.sh <dataset> BYEAR EYEAR

		- Example:
		./preprocess_inputdata.sh era5_ 2000 2010

		- Comments:
		The output produced runs from January BYEAR to December EYEAR-1.

		- Subroutines called:
		1) preprocess_inputdata_year.sh : Loops through years and months.
		2) preprocess_inputdata_month.sh : Reanalysis data preparation for
		each single month.

nudging_cdo.sh
 
		- Description:
		Main script for the preparation and interpolation of nudging files
		based on a given reanalysis dataset. 

                - Called as:
		./nudging_cdo.sh <dataset> <resolution> BYEAR BMONTH EYEAR EMONTH

                - Example:
                ./nudging_cdo.sh era5_ TCO159L91 2000 01 2009 12

                - Comments:
		There will be an outputfile 
                <dataset>_int_month_cdo.aus
                in the directory from which nudging_cdo.sh is called listing all 
		years and months that will be treated.

		- Subroutines called:
		1) nudging_int_cdo.sh : Loops through years and months.
		2) nudging_int_month_cdo.sh : 
		3) nudging_int_month_timestep_cdo.sh : Splitting the input data into
		single timestep files ready for interpolation.
		4) int_cdo.sh : Interpolation and save of the reanalysis data.

main_ecmwf_hpc2020.sh

		- Description:
		Main script for the retrieval, preparation and interpolation of nudging files
		on the ECMWF hpc2020 system based on a given reanalysis dataset. 

                - Called as (from the ecs-login system):
		bash main_ecmwf_hpc2020.sh

                - Comments:
		You must edit a few variables in the script and the script will submit
		a job via sbatch for each month of the chosen period.
		Each sbatch job downloads the raw data from mars, then interpolates
		the data to the target resolution. If you want to process multiple
		resolutions, you can comment the downloading script if the files
		have already been downloaded (default location is in $SCRATH which
		gets deleted afew a few weeks of inactivity.

		- Subroutines called:
		1) get_inputdata_mars.sh : downloads data from mars : called for each year/month
		2) int_cdo.sh : Interpolation and save of the reanalysis data.
